@inject IHttpContextAccessor HttpAccessor
@inject NavigationManager NavigationManager
@using System.Globalization

<select class="border rounded px-2 py-1 text-sm" @bind="currentCulture" @onchange="OnChange">
    <option value="uk">Українська</option>
    <option value="en">English</option>
</select>

@code {
    // Тримаємо вибрану культуру в стані компонента, щоб селект відображав актуальне значення
    private string currentCulture = CultureInfo.CurrentUICulture.TwoLetterISOLanguageName;

    void OnChange(ChangeEventArgs e)
    {
        var culture = e.Value?.ToString() ?? "uk";

        // Ставимо culture-cookie, який підхоплює RequestLocalizationMiddleware
        var ctx = HttpAccessor.HttpContext;
        if (ctx is not null)
        {
            ctx.Response.Cookies.Append(
                ".AspNetCore.Culture",
                $"c={culture}|uic={culture}",
                new CookieOptions { Expires = DateTimeOffset.UtcNow.AddYears(1), IsEssential = true }
            );
        }

        // Оновлюємо локальний стан селекту (на випадок якщо перезавантаження скасували)
        currentCulture = culture;

        // Перезавантажуємо поточну сторінку, щоб застосувати нову культуру з cookie
        var uri = new Uri(NavigationManager.Uri);
        NavigationManager.NavigateTo(uri.GetLeftPart(UriPartial.Path), forceLoad: true);
    }
}