@page "/auth/login"

@using Microsoft.Extensions.Localization
@using Flowly.Web.Resources
@inject IStringLocalizer<SharedResources> T

<link rel="stylesheet" href="/css/auth.css" />

<div class="auth-wrap">
  <div class="auth-card">
    <div class="auth-header">
      <div class="auth-title">@T["Auth_Login_Title"]</div>
      <div class="auth-alt">
        @T["Auth_NoAccount"] <a href="/auth/register">@T["Auth_GoToRegister"]</a>
      </div>
    </div>

    <form id="loginForm" onsubmit="return loginSubmit(event)" @formname="login-html">
      <div class="form-grid">
        <input id="lemail"    class="input" name="email"     placeholder="@T["Auth_Email"]"    required />
        <input id="lpassword" class="input" name="password"  placeholder="@T["Auth_Password"]" type="password" required />
        <label style="display:flex;align-items:center;gap:.5rem;">
          <input id="remember" type="checkbox" /> <span class="note">@T["Auth_RememberMe"]</span>
        </label>
        <button type="submit" class="btn btn-primary">@T["Auth_SignIn"]</button>
        <div id="loginMsg" class="error" aria-live="polite"></div>
      </div>
    </form>
  </div>
</div>

<script>
async function loginSubmit(e) {
  e.preventDefault();
  const msg = document.getElementById('loginMsg');
  msg.textContent = '';

  const body = {
    email: document.getElementById('lemail').value.trim(),
    password: document.getElementById('lpassword').value,
    rememberMe: document.getElementById('remember').checked
  };

  try {
    const res = await fetch('/api/auth/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify(body)
    });

    if (!res.ok) {
      msg.textContent = 'Invalid credentials';
      return false;
    }
    window.location.href = '/dashboard';
    return false;
  } catch {
    msg.textContent = 'Network error';
    return false;
  }
}
</script>