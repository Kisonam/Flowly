@page "/auth/register"

@using Microsoft.Extensions.Localization
@using Flowly.Web.Resources
@inject IStringLocalizer<SharedResources> T

<link rel="stylesheet" href="/css/auth.css" />

<div class="auth-wrap">
  <div class="auth-card">
    <div class="auth-header">
      <div class="auth-title">@T["Auth_Register_Title"]</div>
      <div class="auth-alt">
        @T["Auth_HaveAccount"] <a href="/auth/login">@T["Auth_GoToLogin"]</a>
      </div>
    </div>

    <form id="regForm" onsubmit="return registerSubmit(event)" @formname="reg-html">
      <div class="form-grid">
        <input id="email"    class="input" name="email"     placeholder="@T["Auth_Email"]"     required />
        <input id="password" class="input" name="password"  placeholder="@T["Auth_Password"]"  type="password" required />
        <input id="first"    class="input" name="first"     placeholder="@T["Auth_FirstName"]" required />
        <input id="last"     class="input" name="last"      placeholder="@T["Auth_LastName"]"  required />
        <button type="submit" class="btn btn-primary">@T["Auth_Create"]</button>
        <div id="regMsg" class="error" aria-live="polite"></div>
      </div>
    </form>
  </div>
</div>
<script>
async function registerSubmit(e) {
  e.preventDefault();
  const msg = document.getElementById('regMsg');
  msg.textContent = '';

  const body = {
    email: document.getElementById('email').value.trim(),
    password: document.getElementById('password').value,
    firstName: document.getElementById('first').value.trim(),
    lastName: document.getElementById('last').value.trim()
  };

  try {
    const res = await fetch('/api/auth/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify(body)
    });

    if (!res.ok) {
      let err = null;
      try { err = await res.json(); } catch {}
      msg.textContent = err?.error ?? 'Registration failed';
      return false;
    }
    window.location.href = '/dashboard';
    return false;
  } catch {
    msg.textContent = 'Network error';
    return false;
  }
}
</script>