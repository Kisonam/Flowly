<div class="archive-container">
  <div class="archive-header">
    <div>
      <h1><i class="bi bi-archive"></i> {{ 'ARCHIVE.TITLE' | translate }}</h1>
      <p class="subtitle">{{ 'ARCHIVE.SUBTITLE' | translate }}</p>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filter-group">
      <label for="entityTypeFilter">
        <i class="bi bi-funnel"></i> {{ 'ARCHIVE.FILTERS.TYPE_LABEL' | translate }}
      </label>
      <select id="entityTypeFilter" [(ngModel)]="selectedEntityType" (change)="onEntityTypeChange()"
        class="form-select">
        <option *ngFor="let type of entityTypes" [ngValue]="type.value">
          {{ type.label | translate }}
        </option>
      </select>
    </div>

    <div class="filter-group search-group">
      <label for="searchInput">
        <i class="bi bi-search"></i> {{ 'ARCHIVE.FILTERS.SEARCH_LABEL' | translate }}
      </label>
      <input id="searchInput" type="text" [(ngModel)]="searchQuery" (ngModelChange)="onSearchChange()"
        [placeholder]="'ARCHIVE.FILTERS.SEARCH_PLACEHOLDER' | translate" class="form-control" />
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>{{ 'ARCHIVE.LOADING' | translate }}</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage && !loading" class="error-state">
    <i class="bi bi-exclamation-triangle"></i>
    <p>{{ errorMessage }}</p>
    <button class="btn btn-primary" (click)="loadArchive()">
      {{ 'ARCHIVE.ERRORS.RETRY' | translate }}
    </button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !errorMessage && archivedItems.length === 0" class="empty-state">
    <i class="bi bi-inbox"></i>
    <h3>{{ 'ARCHIVE.EMPTY.TITLE' | translate }}</h3>
    <p>{{ 'ARCHIVE.EMPTY.DESC' | translate }}</p>
  </div>

  <!-- Archive Table -->
  <div *ngIf="!loading && !errorMessage && archivedItems.length > 0" class="archive-table-container">
    <div class="results-info">
      <span>{{ 'ARCHIVE.RESULTS_INFO' | translate: { count: totalCount, suffix: (totalCount === 1 ? 'element' :
        'elements') } }}</span>
    </div>

    <table class="archive-table">
      <thead>
        <tr>
          <th class="col-type">{{ 'ARCHIVE.TABLE.TYPE' | translate }}</th>
          <th class="col-title">{{ 'ARCHIVE.TABLE.TITLE' | translate }}</th>
          <th class="col-metadata">{{ 'ARCHIVE.TABLE.DETAILS' | translate }}</th>
          <th class="col-date">{{ 'ARCHIVE.TABLE.ARCHIVED_AT' | translate }}</th>
          <th class="col-actions">{{ 'ARCHIVE.TABLE.ACTIONS' | translate }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of archivedItems" class="archive-row" (click)="viewDetails(item)">
          <!-- Type -->
          <td class="col-type">
            <div class="entity-type-badge" [attr.data-type]="item.entityType">
              <i class="bi" [ngClass]="getEntityTypeIcon(item.entityType)"></i>
              <span>{{ 'ARCHIVE.FILTERS.TYPES.' + getEntityTypeKey(item.entityType) | translate }}</span>
            </div>
          </td>

          <!-- Title -->
          <td class="col-title">
            <div class="item-title">
              <strong>{{ item.title }}</strong>
              <small *ngIf="item.description" class="item-description">
                {{ item.description }}
              </small>
            </div>
          </td>

          <!-- Metadata -->
          <td class="col-metadata">
            <span class="metadata-text" *ngIf="getMetadataDisplay(item)">
              {{ getMetadataDisplay(item) }}
            </span>
            <span class="metadata-empty" *ngIf="!getMetadataDisplay(item)">â€”</span>
          </td>

          <!-- Date -->
          <td class="col-date">
            <span class="archived-date">{{ formatDate(item.archivedAt) }}</span>
          </td>

          <!-- Actions -->
          <td class="col-actions" (click)="$event.stopPropagation()">
            <div class="action-buttons">
              <button class="btn btn-sm btn-restore" (click)="$event.stopPropagation(); restore(item)"
                [title]="'ARCHIVE.ACTIONS.RESTORE' | translate">
                <i class="bi bi-arrow-counterclockwise"></i>
                {{ 'ARCHIVE.ACTIONS.RESTORE' | translate }}
              </button>
              <button class="btn btn-sm btn-delete" (click)="$event.stopPropagation(); permanentDelete(item)"
                [title]="'ARCHIVE.ACTIONS.DELETE' | translate">
                <i class="bi bi-trash"></i>
                {{ 'ARCHIVE.ACTIONS.DELETE' | translate }}
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button class="btn btn-pagination" [disabled]="currentPage === 1" (click)="previousPage()">
        <i class="bi bi-chevron-left"></i>
        {{ 'ARCHIVE.PAGINATION.PREVIOUS' | translate }}
      </button>

      <span class="page-info">
        {{ 'ARCHIVE.PAGINATION.PAGE_INFO' | translate: { current: currentPage, total: totalPages } }}
      </span>

      <button class="btn btn-pagination" [disabled]="currentPage === totalPages" (click)="nextPage()">
        {{ 'ARCHIVE.PAGINATION.NEXT' | translate }}
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </div>
</div>

<!-- Detail Modal -->
<div class="modal-overlay" *ngIf="showDetailModal" (click)="closeDetailModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>
        <i class="bi" [ngClass]="selectedItem ? getEntityTypeIcon(selectedItem.entityType) : ''"></i>
        {{ 'ARCHIVE.DETAIL_MODAL.TITLE' | translate }}
      </h2>
      <button class="btn-close" (click)="closeDetailModal()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <div class="modal-body" *ngIf="selectedItem">
      <!-- Basic Info -->
      <div class="detail-section">
        <h3>{{ 'ARCHIVE.DETAIL_MODAL.BASIC_INFO' | translate }}</h3>
        <div class="detail-grid">
          <div class="detail-item">
            <label>{{ 'ARCHIVE.TABLE.TYPE' | translate }}:</label>
            <span>{{ 'ARCHIVE.FILTERS.TYPES.' + getEntityTypeKey(selectedItem.entityType) | translate
              }}</span>
          </div>
          <div class="detail-item">
            <label>{{ 'ARCHIVE.TABLE.TITLE' | translate }}:</label>
            <span>{{ selectedItem.title }}</span>
          </div>
          <div class="detail-item" *ngIf="selectedItem.description">
            <label>{{ 'ARCHIVE.METADATA.LABELS.Description' | translate }}:</label>
            <span>{{ selectedItem.description }}</span>
          </div>
          <div class="detail-item">
            <label>{{ 'ARCHIVE.TABLE.ARCHIVED_AT' | translate }}:</label>
            <span>{{ formatDate(selectedItem.archivedAt) }}</span>
          </div>
        </div>
      </div>

      <!-- Metadata -->
      <div class="detail-section" *ngIf="selectedItem.metadata && Object.keys(selectedItem.metadata).length > 0">
        <h3>{{ 'ARCHIVE.DETAIL_MODAL.ADDITIONAL_INFO' | translate }}</h3>
        <div class="detail-grid">
          <div class="detail-item" *ngFor="let meta of Object.entries(selectedItem.metadata)">
            <label>{{ formatMetadataLabel(meta[0]) }}:</label>
            <span>{{ formatMetadataValue(meta[0], meta[1]) }}</span>
          </div>
        </div>
      </div>

      <!-- Detailed Content from Payload -->
      <div class="detail-section" *ngIf="parsedPayload && !parsedPayload.error">
        <h3>{{ getContentSectionTitle() }}</h3>
        <div class="content-viewer">
          <div *ngIf="getContentFromPayload()" class="content-text">
            {{ getContentFromPayload() }}
          </div>
          <div *ngIf="!getContentFromPayload()" class="no-content">
            <i class="bi bi-info-circle"></i>
            <p>{{ 'ARCHIVE.DETAIL_MODAL.NO_CONTENT' | translate }}</p>
          </div>
        </div>
      </div>

      <!-- Error state -->
      <div class="detail-section" *ngIf="parsedPayload && parsedPayload.error">
        <div class="error-message">
          <i class="bi bi-exclamation-triangle"></i>
          <p>{{ parsedPayload.error }}</p>
        </div>
      </div>

      <!-- Loading state -->
      <div class="detail-loading" *ngIf="!parsedPayload">
        <div class="spinner"></div>
        <p>{{ 'ARCHIVE.DETAIL_MODAL.LOADING' | translate }}</p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeDetailModal()">
        {{ 'ARCHIVE.DETAIL_MODAL.CLOSE' | translate }}
      </button>
      <button class="btn btn-primary" (click)="restore(selectedItem!); closeDetailModal()">
        <i class="bi bi-arrow-counterclockwise"></i>
        {{ 'ARCHIVE.DETAIL_MODAL.RESTORE' | translate }}
      </button>
    </div>
  </div>
</div>