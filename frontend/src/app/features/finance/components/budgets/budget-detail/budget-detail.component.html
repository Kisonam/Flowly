<div class="budget-detail-container">
  <!-- Header -->
  <div class="detail-header">
    <button class="btn btn-back" (click)="goBack()">
      <span>â†</span> Back to Budgets
    </button>
    <h2>ğŸ’¼ Budget Details</h2>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading budget...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage" class="error-state">
    <p>âŒ {{ errorMessage }}</p>
    <button class="btn btn-primary" (click)="goBack()">Back to List</button>
  </div>

  <!-- Budget Detail -->
  <div *ngIf="!loading && !errorMessage && budget" class="budget-detail">
    <!-- Main Card -->
    <div class="detail-card main-card">
      <!-- Header -->
      <div class="card-header">
        <div class="budget-title-section">
          <h1>{{ budget.title }}</h1>
          <p *ngIf="budget.description" class="budget-description">
            {{ budget.description }}
          </p>
        </div>
      </div>

      <!-- Progress Section -->
      <div class="progress-section">
        <div class="amount-summary">
          <div class="amount-item spent">
            <label>Spent</label>
            <div class="amount-value" [style.color]="isOverBudget() ? '#ef4444' : '#1f2937'">
              {{ formatAmount(budget.currentSpent, budget.currencyCode) }}
            </div>
          </div>
          <div class="amount-divider">/</div>
          <div class="amount-item limit">
            <label>Limit</label>
            <div class="amount-value">
              {{ formatAmount(budget.limit, budget.currencyCode) }}
            </div>
          </div>
        </div>

        <div class="progress-bar-container">
          <div class="progress-bar">
            <div
              class="progress-fill"
              [style.width.%]="getProgressPercentage()"
              [style.background]="getProgressColor()">
            </div>
          </div>
          <div class="progress-label">
            {{ getProgressPercentage().toFixed(1) }}%
          </div>
        </div>

        <div class="remaining-section" *ngIf="!isOverBudget()">
          <div class="remaining-icon">ğŸ’°</div>
          <div class="remaining-text">
            <strong>{{ formatAmount(getRemainingAmount(), budget.currencyCode) }}</strong>
            <span>remaining</span>
          </div>
        </div>

        <div class="overbudget-section" *ngIf="isOverBudget()">
          <div class="overbudget-icon">âš ï¸</div>
          <div class="overbudget-text">
            <strong>Over budget by {{ formatAmount(budget.currentSpent - budget.limit, budget.currencyCode) }}</strong>
          </div>
        </div>
      </div>

      <!-- Details Section -->
      <div class="details-section">
        <!-- Category -->
        <div class="detail-item" *ngIf="budget.category">
          <label>Category</label>
          <div class="category-display">
            <span
              class="category-badge"
              [style.background]="budget.category.color || '#e5e7eb'">
              <span *ngIf="budget.category.icon">{{ budget.category.icon }}</span>
              {{ budget.category.name }}
            </span>
          </div>
        </div>

        <!-- Period Dates -->
        <div class="detail-item">
          <label>Period</label>
          <div class="date-range">
            <div class="date-box">
              <span class="date-label">Start</span>
              <span class="date-value">{{ formatDate(budget.periodStart) }}</span>
            </div>
            <div class="date-arrow">â†’</div>
            <div class="date-box">
              <span class="date-label">End</span>
              <span class="date-value">{{ formatDate(budget.periodEnd) }}</span>
            </div>
          </div>
        </div>

        <!-- Days Remaining -->
        <div class="detail-item" *ngIf="budget.daysRemaining !== undefined">
          <label>Time Left</label>
          <div class="days-remaining">
            <span class="days-number">{{ budget.daysRemaining }}</span>
            <span class="days-label">days remaining</span>
          </div>
        </div>

        <!-- Status -->
        <div class="detail-item">
          <label>Status</label>
          <div class="status-badges">
            <span class="status-badge exceeded" *ngIf="budget.isExceeded">
              âš ï¸ Exceeded
            </span>
          </div>
        </div>

        <!-- Created/Updated -->
        <div class="detail-item">
          <label>Created</label>
          <div class="timestamp">{{ formatDate(budget.createdAt) }}</div>
        </div>
        <div class="detail-item" *ngIf="budget.updatedAt">
          <label>Last Updated</label>
          <div class="timestamp">{{ formatDate(budget.updatedAt) }}</div>
        </div>
      </div>
    </div>

    <!-- Actions Card -->
    <div class="detail-card actions-card">
      <h3>Actions</h3>
      <div class="action-buttons">
        <button class="btn btn-primary" (click)="editBudget()">
          <span>âœï¸</span> Edit Budget
        </button>
        <button
          *ngIf="!budget.isArchived"
          class="btn btn-secondary"
          (click)="deleteBudget()">
          <span>ğŸ“¦</span> Archive
        </button>
        <button
          *ngIf="budget.isArchived"
          class="btn btn-secondary"
          (click)="restoreBudget()">
          <span>â†©ï¸</span> Restore
        </button>
        <button
          *ngIf="budget.isArchived"
          class="btn btn-danger"
          (click)="deleteBudget()">
          <span>ğŸ—‘ï¸</span> Delete Permanently
        </button>
      </div>
    </div>

    <!-- Transactions Card -->
    <div class="detail-card transactions-card">
      <div class="card-header">
        <h3>ğŸ’° Linked Transactions</h3>
        <span class="transaction-count">{{ transactions.length }} transaction{{ transactions.length !== 1 ? 's' : '' }}</span>
      </div>

      <!-- Loading State -->
      <div *ngIf="loadingTransactions" class="loading-state">
        <div class="spinner-small"></div>
        <p>Loading transactions...</p>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loadingTransactions && transactions.length === 0" class="empty-state">
        <p>ğŸ“­ No transactions linked to this budget yet</p>
      </div>

      <!-- Transactions List -->
      <div *ngIf="!loadingTransactions && transactions.length > 0" class="transactions-list">
        <div
          *ngFor="let transaction of transactions"
          class="transaction-item"
          (click)="viewTransaction(transaction.id)">
          <div class="transaction-icon" [style.color]="getTransactionTypeColor(transaction.type)">
            {{ getTransactionTypeIcon(transaction.type) }}
          </div>
          <div class="transaction-info">
            <div class="transaction-title">{{ transaction.title }}</div>
            <div class="transaction-meta">
              <span class="transaction-date">{{ formatDate(transaction.date) }}</span>
              <span *ngIf="transaction.category" class="transaction-category">
                â€¢ {{ transaction.category.name }}
              </span>
            </div>
          </div>
          <div class="transaction-amount" [style.color]="getTransactionTypeColor(transaction.type)">
            <span class="amount-sign">{{ transaction.type === 'Income' ? '+' : '-' }}</span>
            {{ formatAmount(transaction.amount, transaction.currencyCode) }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
