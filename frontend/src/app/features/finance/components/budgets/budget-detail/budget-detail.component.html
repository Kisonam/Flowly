<div class="budget-detail-container">
  <!-- Header -->
  <div class="detail-header">
    <button class="btn btn-back" (click)="goBack()">
      <span>‚Üê</span> {{ 'FINANCE.BUDGETS.DETAIL.BACK' | translate }}
    </button>
    <h2>üíº {{ 'FINANCE.BUDGETS.DETAIL.TITLE' | translate }}</h2>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>{{ 'FINANCE.BUDGETS.LOADING' | translate }}</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage" class="error-state">
    <p>‚ùå {{ errorMessage }}</p>
    <button class="btn btn-primary" (click)="goBack()">{{ 'FINANCE.BUDGETS.DETAIL.BACK_LIST' | translate }}</button>
  </div>

  <!-- Budget Detail -->
  <div *ngIf="!loading && !errorMessage && budget" class="budget-detail">
    <!-- Main Card -->
    <div class="detail-card main-card">
      <!-- Header -->
      <div class="card-header">
        <div class="budget-title-section">
          <h1>{{ budget.title }}</h1>
          <p *ngIf="budget.description" class="budget-description">
            {{ budget.description }}
          </p>
        </div>
      </div>

      <!-- Progress Section -->
      <div class="progress-section">
        <div class="amount-summary">
          <div class="amount-item spent">
            <label>{{ 'FINANCE.BUDGETS.DETAIL.SPENT' | translate }}</label>
            <div class="amount-value" [style.color]="isOverBudget() ? '#ef4444' : '#1f2937'">
              {{ formatAmount(budget.currentSpent, budget.currencyCode) }}
            </div>
          </div>
          <div class="amount-divider">/</div>
          <div class="amount-item limit">
            <label>{{ 'FINANCE.BUDGETS.DETAIL.LIMIT' | translate }}</label>
            <div class="amount-value">
              {{ formatAmount(budget.limit, budget.currencyCode) }}
            </div>
          </div>
        </div>

        <div class="progress-bar-container">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="getProgressPercentage()"
              [style.background]="getProgressColor()">
            </div>
          </div>
          <div class="progress-label">
            {{ getProgressPercentage().toFixed(1) }}%
          </div>
        </div>

        <div class="remaining-section" *ngIf="!isOverBudget()">
          <div class="remaining-icon">üí∞</div>
          <div class="remaining-text">
            <strong>{{ formatAmount(getRemainingAmount(), budget.currencyCode) }}</strong>
            <span>{{ 'FINANCE.BUDGETS.DETAIL.REMAINING' | translate }}</span>
          </div>
        </div>

        <div class="overbudget-section" *ngIf="isOverBudget()">
          <div class="overbudget-icon">‚ö†Ô∏è</div>
          <div class="overbudget-text">
            <strong>{{ 'FINANCE.BUDGETS.DETAIL.OVER_BY' | translate:{amount: formatAmount(budget.currentSpent -
              budget.limit, budget.currencyCode)} }}</strong>
          </div>
        </div>
      </div>

      <!-- Details Section -->
      <div class="details-section">
        <!-- Category -->
        <div class="detail-item" *ngIf="budget.category">
          <label>{{ 'FINANCE.BUDGETS.DETAIL.CATEGORY' | translate }}</label>
          <div class="category-display">
            <span class="category-badge" [style.background]="budget.category.color || '#e5e7eb'">
              <span *ngIf="budget.category.icon">{{ budget.category.icon }}</span>
              {{ budget.category.name }}
            </span>
          </div>
        </div>

        <!-- Period Dates -->
        <div class="detail-item">
          <label>{{ 'FINANCE.BUDGETS.DETAIL.PERIOD' | translate }}</label>
          <div class="date-range">
            <div class="date-box">
              <span class="date-label">{{ 'FINANCE.BUDGETS.DETAIL.START' | translate }}</span>
              <span class="date-value">{{ formatDate(budget.periodStart) }}</span>
            </div>
            <div class="date-arrow">‚Üí</div>
            <div class="date-box">
              <span class="date-label">{{ 'FINANCE.BUDGETS.DETAIL.END' | translate }}</span>
              <span class="date-value">{{ formatDate(budget.periodEnd) }}</span>
            </div>
          </div>
        </div>

        <!-- Days Remaining -->
        <div class="detail-item" *ngIf="budget.daysRemaining !== undefined">
          <label>{{ 'FINANCE.BUDGETS.DETAIL.TIME_LEFT' | translate }}</label>
          <div class="days-remaining">
            <span class="days-number">{{ budget.daysRemaining }}</span>
            <span class="days-label">{{ 'FINANCE.BUDGETS.DETAIL.DAYS_REMAINING' | translate }}</span>
          </div>
        </div>

        <!-- Status -->
        <div class="detail-item">
          <label>{{ 'FINANCE.BUDGETS.DETAIL.STATUS' | translate }}</label>
          <div class="status-badges">
            <span class="status-badge exceeded" *ngIf="budget.isExceeded">
              {{ 'FINANCE.BUDGETS.DETAIL.EXCEEDED' | translate }}
            </span>
          </div>
        </div>

        <!-- Created/Updated -->
        <div class="detail-item">
          <label>{{ 'FINANCE.BUDGETS.DETAIL.CREATED' | translate }}</label>
          <div class="timestamp">{{ formatDate(budget.createdAt) }}</div>
        </div>
        <div class="detail-item" *ngIf="budget.updatedAt">
          <label>{{ 'FINANCE.BUDGETS.DETAIL.UPDATED' | translate }}</label>
          <div class="timestamp">{{ formatDate(budget.updatedAt) }}</div>
        </div>
      </div>
    </div>

    <!-- Actions Card -->
    <div class="detail-card actions-card">
      <h3>{{ 'FINANCE.BUDGETS.DETAIL.ACTIONS' | translate }}</h3>
      <div class="action-buttons">
        <button class="btn btn-primary" (click)="editBudget()">
          <span>‚úèÔ∏è</span> {{ 'FINANCE.BUDGETS.DETAIL.EDIT' | translate }}
        </button>
        <button *ngIf="!budget.isArchived" class="btn btn-secondary" (click)="deleteBudget()">
          <span>üì¶</span> {{ 'FINANCE.BUDGETS.DETAIL.ARCHIVE' | translate }}
        </button>
        <button *ngIf="budget.isArchived" class="btn btn-secondary" (click)="restoreBudget()">
          <span>‚Ü©Ô∏è</span> {{ 'FINANCE.BUDGETS.DETAIL.RESTORE' | translate }}
        </button>
        <button *ngIf="budget.isArchived" class="btn btn-danger" (click)="deleteBudget()">
          <span>üóëÔ∏è</span> {{ 'FINANCE.BUDGETS.DETAIL.DELETE' | translate }}
        </button>
      </div>
    </div>

    <!-- Transactions Card -->
    <div class="detail-card transactions-card">
      <div class="card-header">
        <h3>üí∞ {{ 'FINANCE.BUDGETS.DETAIL.TRANSACTIONS' | translate }}</h3>
        <span class="transaction-count">{{ 'FINANCE.BUDGETS.DETAIL.TRANSACTIONS_COUNT' | translate:{count:
          transactions.length, suffix: (transactions.length !== 1 ? 's' : '')} }}</span>
      </div>

      <!-- Loading State -->
      <div *ngIf="loadingTransactions" class="loading-state">
        <div class="spinner-small"></div>
        <p>{{ 'FINANCE.BUDGETS.DETAIL.TRANSACTIONS_LOADING' | translate }}</p>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loadingTransactions && transactions.length === 0" class="empty-state">
        <p>{{ 'FINANCE.BUDGETS.DETAIL.TRANSACTIONS_EMPTY' | translate }}</p>
      </div>

      <!-- Transactions List -->
      <div *ngIf="!loadingTransactions && transactions.length > 0" class="transactions-list">
        <div *ngFor="let transaction of transactions" class="transaction-item"
          (click)="viewTransaction(transaction.id)">
          <div class="transaction-icon" [style.color]="getTransactionTypeColor(transaction.type)">
            {{ getTransactionTypeIcon(transaction.type) }}
          </div>
          <div class="transaction-info">
            <div class="transaction-title">{{ transaction.title }}</div>
            <div class="transaction-meta">
              <span class="transaction-date">{{ formatDate(transaction.date) }}</span>
              <span *ngIf="transaction.category" class="transaction-category">
                ‚Ä¢ {{ transaction.category.name }}
              </span>
            </div>
          </div>
          <div class="transaction-amount" [style.color]="getTransactionTypeColor(transaction.type)">
            <span class="amount-sign">{{ transaction.type === 'Income' ? '+' : '-' }}</span>
            {{ formatAmount(transaction.amount, transaction.currencyCode) }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>