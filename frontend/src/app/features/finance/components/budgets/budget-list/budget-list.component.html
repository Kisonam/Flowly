<div class="budget-list-container">
  <!-- Header -->
  <div class="module-header">
    <h2>üíº {{ 'FINANCE.BUDGETS.TITLE' | translate }}</h2>
    <div class="header-actions">
      <button class="btn btn-secondary" routerLink="/finance/transactions">
        <span>üí∞</span> {{ 'FINANCE.BUDGETS.TRANSACTIONS_BUTTON' | translate }}
      </button>
      <button class="btn btn-secondary" routerLink="/finance/categories">
        <span>üìÇ</span> {{ 'FINANCE.BUDGETS.CATEGORIES_BUTTON' | translate }}
      </button>
      <button class="btn btn-primary" routerLink="/finance/budgets/new">
        <span>+</span> {{ 'FINANCE.BUDGETS.NEW_BUTTON' | translate }}
      </button>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-card" [formGroup]="filterForm">
    <!-- Filter Results Counter -->
    <div *ngIf="!loading && budgets.length > 0" class="filter-results">
      {{ 'FINANCE.BUDGETS.FILTERS.SHOWING' | translate:{count: filteredBudgets.length, total: budgets.length} }}
    </div>

    <!-- First Row: Search and Status -->
    <div class="filters-row">
      <div class="filter-group">
        <label>{{ 'FINANCE.BUDGETS.FILTERS.SEARCH_LABEL' | translate }}</label>
        <input type="text" formControlName="search"
          [placeholder]="'FINANCE.BUDGETS.FILTERS.SEARCH_PLACEHOLDER' | translate" class="filter-input" />
      </div>
      <div class="filter-group">
        <label>{{ 'FINANCE.BUDGETS.FILTERS.CURRENCY_LABEL' | translate }}</label>
        <select formControlName="currencyCode" class="filter-select" [disabled]="loadingCurrencies">
          <option value="">{{ loadingCurrencies ? ('FINANCE.BUDGETS.FILTERS.CURRENCY_LOADING' | translate) :
            ('FINANCE.BUDGETS.FILTERS.CURRENCY_ALL' | translate) }}</option>
          <option *ngFor="let currency of currencies" [value]="currency.code">
            {{ currency.symbol }} {{ currency.code }} - {{ currency.name }}
          </option>
        </select>
      </div>
    </div>

    <!-- Second Row: Amount and Date Range -->
    <div class="filters-row">
      <div class="filter-group">
        <label>{{ 'FINANCE.BUDGETS.FILTERS.MIN_AMOUNT' | translate }}</label>
        <input type="number" formControlName="minAmount" placeholder="0" class="filter-input" step="0.01" />
      </div>

      <div class="filter-group">
        <label>{{ 'FINANCE.BUDGETS.FILTERS.MAX_AMOUNT' | translate }}</label>
        <input type="number" formControlName="maxAmount" [placeholder]="'FINANCE.BUDGETS.FILTERS.NO_LIMIT' | translate"
          class="filter-input" step="0.01" />
      </div>

      <div class="filter-group">
        <label>{{ 'FINANCE.BUDGETS.FILTERS.PERIOD_START' | translate }}</label>
        <input type="date" formControlName="periodStart" class="filter-input" />
      </div>

      <div class="filter-group">
        <label>{{ 'FINANCE.BUDGETS.FILTERS.PERIOD_END' | translate }}</label>
        <input type="date" formControlName="periodEnd" class="filter-input" />
      </div>

      <div class="filter-group filter-actions">
        <button class="btn btn-secondary" (click)="clearFilters()">
          {{ 'FINANCE.BUDGETS.FILTERS.CLEAR' | translate }}
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>{{ 'FINANCE.BUDGETS.LOADING' | translate }}</p>
  </div>

  <!-- Error State -->
  <div *ngIf="!loading && errorMessage" class="error-state">
    <p class="error-message">{{ errorMessage }}</p>
    <button class="btn btn-secondary" (click)="fetchBudgets()">{{ 'FINANCE.BUDGETS.ERRORS.RETRY' | translate }}</button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !errorMessage && budgets.length === 0" class="empty-state">
    <div class="empty-icon">üíº</div>
    <h3>{{ 'FINANCE.BUDGETS.EMPTY.TITLE' | translate }}</h3>
    <p>{{ 'FINANCE.BUDGETS.EMPTY.DESC' | translate }}</p>
    <button class="btn btn-primary" routerLink="/finance/budgets/new">
      <span>+</span> {{ 'FINANCE.BUDGETS.EMPTY.BUTTON' | translate }}
    </button>
  </div>

  <!-- No Results After Filtering -->
  <div *ngIf="!loading && !errorMessage && budgets.length > 0 && filteredBudgets.length === 0" class="empty-state">
    <div class="empty-icon">üîç</div>
    <h3>{{ 'FINANCE.BUDGETS.NO_RESULTS.TITLE' | translate }}</h3>
    <p>{{ 'FINANCE.BUDGETS.NO_RESULTS.DESC' | translate }}</p>
    <button class="btn btn-secondary" (click)="clearFilters()">
      {{ 'FINANCE.BUDGETS.NO_RESULTS.BUTTON' | translate }}
    </button>
  </div>

  <!-- Budget List -->
  <div *ngIf="!loading && !errorMessage && filteredBudgets.length > 0" class="budgets-grid">
    <div *ngFor="let budget of filteredBudgets" class="budget-card"
      [class.overspent]="isOverspent(budget)"
      [class.expired]="isExpired(budget)"
      (click)="viewBudget(budget)">

      <div class="budget-content">
        <!-- Header -->
        <div class="budget-header">
          <h3 class="budget-title">{{ budget.title }}</h3>
          <div class="budget-period">
            {{ formatDate(budget.periodStart) }} - {{ formatDate(budget.periodEnd) }}
          </div>
        </div>

        <!-- Description (always present, but may be empty) -->
        <div class="budget-description">
          <p *ngIf="budget.description">{{ budget.description }}</p>
        </div>

        <!-- Category (always present, but may be empty) -->
        <div class="budget-category">
          <span *ngIf="budget.category" class="category-badge" [style.background]="getCategoryColor(budget.category)">
            <span *ngIf="budget.category.icon">{{ budget.category.icon }}</span>
            {{ budget.category.name }}
          </span>
        </div>

        <!-- Progress Bar -->
        <div class="progress-section">
        <div class="progress-info">
          <span class="spent">
            {{ formatCurrency(budget.currentSpent, budget.currencyCode) }}
          </span>
          <span class="divider">/</span>
          <span class="limit">
            {{ formatCurrency(budget.limit, budget.currencyCode) }}
          </span>
        </div>

        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="getProgressPercentage(budget)"
            [style.background]="getProgressColor(budget)">
          </div>
        </div>

        <div class="progress-footer">
          <span class="percentage" [style.color]="getProgressColor(budget)">
            {{ getProgressPercentage(budget) }}%
          </span>
          <span class="remaining">
            {{ formatCurrency(budget.remainingAmount, budget.currencyCode) }} {{ 'FINANCE.BUDGETS.CARD.REMAINING' |
            translate }}
          </span>
        </div>
      </div>

      <!-- Status Badge -->
      <div class="budget-status">
        <span *ngIf="isOverspent(budget)" class="status-badge overspent">
          {{ 'FINANCE.BUDGETS.CARD.OVER_BUDGET' | translate }}
        </span>
        <span *ngIf="!isOverspent(budget) && getProgressPercentage(budget) >= 80 && !isExpired(budget)" class="status-badge warning">
          {{ 'FINANCE.BUDGETS.CARD.NEAR_LIMIT' | translate }}
        </span>
        <span *ngIf="getProgressPercentage(budget) < 80 && !isExpired(budget)" class="status-badge ok">
          {{ 'FINANCE.BUDGETS.CARD.ON_TRACK' | translate }}
        </span>
      </div>

      <!-- Days Remaining -->
      <div class="budget-days">
        <span class="days-text">{{ getDaysRemaining(budget) }}</span>
      </div>

        <!-- Expired Warning -->
        <div class="expired-warning" *ngIf="isExpired(budget)">
          <i class="bi bi-exclamation-triangle"></i>
          <span>{{ 'FINANCE.BUDGETS.CARD.EXPIRED_MESSAGE' | translate }}</span>
        </div>
      </div>

      <!-- Actions -->
      <div class="budget-actions" (click)="$event.stopPropagation()">
        <button *ngIf="budget.isArchived" class="btn-icon restore" (click)="restoreBudget(budget)"
          [title]="'FINANCE.BUDGETS.DETAIL.RESTORE' | translate">
          ‚ôªÔ∏è
        </button>
        <button *ngIf="!budget.isArchived" class="btn-icon edit" [routerLink]="['/finance/budgets', budget.id, 'edit']"
          [title]="'FINANCE.BUDGETS.DETAIL.EDIT' | translate">
          ‚úèÔ∏è
        </button>
        <button class="btn-icon delete" (click)="deleteBudget(budget)"
          [title]="(budget.isArchived ? 'FINANCE.BUDGETS.DETAIL.DELETE' : 'FINANCE.BUDGETS.DETAIL.ARCHIVE') | translate">
          {{ budget.isArchived ? 'üóëÔ∏è' : 'üì¶' }}
        </button>
      </div>
    </div>
  </div>
</div>
