<div class="goal-list">
  <div class="list-header">
    <h1>üéØ {{ 'FINANCE.GOALS.TITLE' | translate }}</h1>
    <button class="btn btn-primary" (click)="createGoal()">‚ûï {{ 'FINANCE.GOALS.NEW_BUTTON' | translate }}</button>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <form [formGroup]="filterForm" class="filters-form">
      <div class="filter-row">
        <div class="filter-group search-group">
          <label>{{ 'FINANCE.GOALS.FILTERS.SEARCH_LABEL' | translate }}</label>
          <input type="text" formControlName="search"
            [placeholder]="'FINANCE.GOALS.FILTERS.SEARCH_PLACEHOLDER' | translate" class="filter-input" />
        </div>

        <div class="filter-group">
          <label>{{ 'FINANCE.GOALS.FILTERS.STATUS_LABEL' | translate }}</label>
          <select formControlName="status" class="filter-select">
            <option value="active">{{ 'FINANCE.GOALS.FILTERS.STATUS_ACTIVE' | translate }}</option>
            <option value="completed">{{ 'FINANCE.GOALS.FILTERS.STATUS_COMPLETED' | translate }}</option>
            <option value="all">{{ 'FINANCE.GOALS.FILTERS.STATUS_ALL' | translate }}</option>
            <option value="archived">{{ 'FINANCE.GOALS.FILTERS.STATUS_ARCHIVED' | translate }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label>{{ 'FINANCE.GOALS.FILTERS.CURRENCY_LABEL' | translate }}</label>
          <select formControlName="currencyCode" class="filter-select" [disabled]="loadingCurrencies">
            <option value="">{{ (loadingCurrencies ? 'FINANCE.GOALS.FILTERS.CURRENCY_LOADING' :
              'FINANCE.GOALS.FILTERS.CURRENCY_ALL') | translate }}</option>
            <option *ngFor="let currency of currencies" [value]="currency.code">
              {{ currency.symbol }} {{ currency.code }} - {{ currency.name }}
            </option>
          </select>
        </div>

        <button type="button" class="btn btn-secondary" (click)="clearFilters()">üîÑ {{ 'FINANCE.GOALS.FILTERS.CLEAR' |
          translate }}</button>
      </div>
    </form>

    <!-- Results counter -->
    <div class="results-counter" *ngIf="!loading">
      <span>{{ 'FINANCE.GOALS.FILTERS.SHOWING' | translate:{count: filteredGoals.length, total: goals.length} }}</span>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>{{ 'FINANCE.GOALS.LOADING' | translate }}</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage && !loading" class="error-state">
    <p>‚ùå {{ errorMessage }}</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && empty" class="empty-state">
    <div class="empty-icon">üéØ</div>
    <h3>{{ 'FINANCE.GOALS.EMPTY.TITLE' | translate }}</h3>
    <p>{{ 'FINANCE.GOALS.EMPTY.DESC' | translate }}</p>
    <button class="btn btn-primary" (click)="createGoal()">‚ûï {{ 'FINANCE.GOALS.EMPTY.BUTTON' | translate }}</button>
  </div>

  <!-- No Results State -->
  <div *ngIf="!loading && !empty && filteredGoals.length === 0" class="empty-state">
    <div class="empty-icon">üîç</div>
    <h3>{{ 'FINANCE.GOALS.NO_RESULTS.TITLE' | translate }}</h3>
    <p>{{ 'FINANCE.GOALS.NO_RESULTS.DESC' | translate }}</p>
  </div>

  <!-- Goals Grid -->
  <div *ngIf="!loading && filteredGoals.length > 0" class="goals-grid">
    <div *ngFor="let goal of filteredGoals" class="goal-card" [class.completed]="goal.isCompleted"
      [class.archived]="goal.isArchived" (click)="viewGoal(goal.id)">

      <!-- Card Header -->
      <div class="card-header">
        <h3 class="goal-title">{{ goal.title }}</h3>
        <div class="goal-actions">
          <button class="btn-icon" (click)="editGoal(goal.id); $event.stopPropagation()"
            [title]="'FINANCE.GOALS.CARD.EDIT' | translate">‚úèÔ∏è</button>

          <button *ngIf="!goal.isArchived" class="btn-icon" (click)="archiveGoal(goal.id); $event.stopPropagation()"
            [title]="'FINANCE.GOALS.CARD.ARCHIVE' | translate">üì¶</button>
          <button *ngIf="goal.isArchived" class="btn-icon" (click)="restoreGoal(goal.id); $event.stopPropagation()"
            [title]="'FINANCE.GOALS.CARD.RESTORE' | translate">‚ôªÔ∏è</button>

          <button *ngIf="goal.isArchived" class="btn-icon danger"
            (click)="deleteGoal(goal.id); $event.stopPropagation()"
            [title]="'FINANCE.GOALS.CARD.DELETE' | translate">üóëÔ∏è</button>
        </div>
      </div>

      <!-- Description (always present, but may be empty) -->
      <p class="goal-description">{{ goal.description || '' }}</p>

      <!-- Status Badges -->
      <div class="status-badges">
        <span *ngIf="goal.isCompleted" class="badge completed">‚úÖ {{ 'FINANCE.GOALS.CARD.COMPLETED' | translate }}</span>
        <span *ngIf="goal.isArchived" class="badge archived">üì¶ {{ 'FINANCE.GOALS.CARD.ARCHIVED' | translate }}</span>
        <span *ngIf="goal.isOverdue && !goal.isCompleted" class="badge overdue">‚è∞ {{ 'FINANCE.GOALS.CARD.OVERDUE' |
          translate }}</span>
        <span *ngIf="goal.isDeadlineApproaching && !goal.isCompleted && !goal.isOverdue" class="badge approaching">‚ö†Ô∏è {{
          'FINANCE.GOALS.CARD.APPROACHING' | translate }}</span>
      </div>

      <!-- Progress Section -->
      <div class="progress-section">
        <div class="progress-header">
          <span class="progress-percentage">{{ goal.progressPercentage }}%</span>
          <span class="progress-amounts">
            {{ goal.currentAmount | number:'1.2-2' }} / {{ goal.targetAmount | number:'1.2-2' }} {{ goal.currencyCode }}
          </span>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="goal.progressPercentage" [class.completed]="goal.isCompleted"
            [class.high]="goal.progressPercentage >= 75 && !goal.isCompleted"
            [class.medium]="goal.progressPercentage >= 50 && goal.progressPercentage < 75"
            [class.low]="goal.progressPercentage < 50">
          </div>
        </div>

        <!-- Deadline Countdown -->
        <div class="deadline-section" *ngIf="goal.deadline">
          <div class="deadline-info" [class]="getDeadlineClass(goal)">
            <span class="deadline-icon">üìÖ</span>
            <span class="deadline-text">{{ getDeadlineCountdown(goal.deadline) }}</span>
            <span class="deadline-date">({{ goal.deadline | date:'dd/MM/yyyy' }})</span>
          </div>
        </div>

        <!-- Completion Info -->
        <div class="completion-info" *ngIf="goal.completedAt">
          <span class="completion-icon">üéâ</span>
          <span class="completion-text">{{ 'FINANCE.GOALS.CARD.COMPLETED_AT' | translate }} {{ goal.completedAt |
            date:'dd/MM/yyyy' }}</span>
        </div>
      </div>

      <!-- Archived Timestamp -->
      <div class="archived-info" *ngIf="goal.isArchived">
        <span class="archived-text">üì¶ {{ 'FINANCE.GOALS.CARD.ARCHIVED_AT' | translate }} {{ goal.createdAt |
          date:'dd/MM/yyyy' }}</span>
      </div>
    </div>
  </div>
</div>
