<div class="transaction-detail-container">
  <!-- Header -->
  <div class="detail-header">
    <button class="btn btn-back" (click)="goBack()">
      <span>‚Üê</span> {{ 'FINANCE.TRANSACTIONS.DETAIL.BACK' | translate }}
    </button>
    <h2>üí∞ {{ 'FINANCE.TRANSACTIONS.DETAIL.TITLE' | translate }}</h2>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>{{ 'FINANCE.TRANSACTIONS.DETAIL.LOADING' | translate }}</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage" class="error-state">
    <p>‚ùå {{ errorMessage }}</p>
    <button class="btn btn-primary" (click)="goBack()">{{ 'FINANCE.TRANSACTIONS.DETAIL.BACK_LIST' | translate
      }}</button>
  </div>

  <!-- Transaction Detail -->
  <div *ngIf="!loading && !errorMessage && transaction" class="transaction-detail">
    <!-- Main Card -->
    <div class="detail-card main-card">
      <div class="card-header" [style.background]="getTransactionColor(transaction.type)">
        <div class="type-badge">
          <span class="type-icon">{{ getTransactionIcon(transaction.type) }}</span>
          <span class="type-label">{{ transaction.type }}</span>
        </div>
        <div class="amount-display">
          <h1>{{ formatAmount(transaction.amount, transaction.currencyCode) }}</h1>
        </div>
      </div>

      <div class="card-body">
        <!-- Title & Description -->
        <div class="info-section">
          <h3 class="transaction-title">{{ transaction.title }}</h3>
          <p class="transaction-description" *ngIf="transaction.description">
            {{ transaction.description }}
          </p>
          <p class="no-description" *ngIf="!transaction.description">
            <em>{{ 'FINANCE.TRANSACTIONS.DETAIL.NO_DESCRIPTION' | translate }}</em>
          </p>
        </div>

        <!-- Category -->
        <div class="info-section">
          <label>{{ 'FINANCE.TRANSACTIONS.DETAIL.CATEGORY' | translate }}</label>
          <div class="category-display" *ngIf="transaction.category">
            <span class="category-badge large" [style.background]="transaction.category.color || '#e5e7eb'">
              <span *ngIf="transaction.category.icon">{{ transaction.category.icon }}</span>
              {{ transaction.category.name }}
            </span>
          </div>
          <p class="no-category" *ngIf="!transaction.category">
            <em>{{ 'FINANCE.TRANSACTIONS.DETAIL.UNCATEGORIZED' | translate }}</em>
          </p>
        </div>

        <!-- Budget -->
        <div class="info-section" *ngIf="transaction.budget">
          <label>{{ 'FINANCE.TRANSACTIONS.DETAIL.BUDGET_LINK' | translate }}</label>
          <div class="linked-item budget-link" (click)="navigateToBudget(transaction.budgetId!)">
            <span class="link-icon">üíº</span>
            <div class="link-info">
              <span class="link-title">{{ transaction.budget.title }}</span>
              <span class="link-currency">{{ transaction.budget.currencyCode }}</span>
            </div>
            <span class="link-arrow">‚Üí</span>
          </div>
        </div>

        <!-- Goal -->
        <div class="info-section" *ngIf="transaction.goal">
          <label>{{ 'FINANCE.TRANSACTIONS.DETAIL.GOAL_LINK' | translate }}</label>
          <div class="linked-item goal-link" (click)="navigateToGoal(transaction.goalId!)">
            <span class="link-icon">üéØ</span>
            <div class="link-info">
              <span class="link-title">{{ transaction.goal.title }}</span>
              <span class="link-currency">{{ transaction.goal.currencyCode }}</span>
            </div>
            <span class="link-arrow">‚Üí</span>
          </div>
        </div>

        <!-- Tags -->
        <div class="info-section" *ngIf="transaction.tags && transaction.tags.length > 0">
          <label>{{ 'FINANCE.TRANSACTIONS.DETAIL.TAGS' | translate }}</label>
          <div class="tags-display">
            <span *ngFor="let tag of transaction.tags" class="tag-chip large"
              [style.background]="tag.color || '#8b5cf6'">
              {{ tag.name }}
            </span>
          </div>
        </div>

        <!-- Date Information -->
        <div class="info-section">
          <div class="dates-grid">
            <div class="date-item">
              <label>{{ 'FINANCE.TRANSACTIONS.DETAIL.DATE' | translate }}</label>
              <p class="date-value">{{ formatDate(transaction.date) }}</p>
            </div>
            <div class="date-item">
              <label>{{ 'FINANCE.TRANSACTIONS.DETAIL.CREATED_AT' | translate }}</label>
              <p class="date-value">{{ formatDateTime(transaction.createdAt) }}</p>
            </div>
            <div class="date-item" *ngIf="transaction.updatedAt">
              <label>{{ 'FINANCE.TRANSACTIONS.DETAIL.UPDATED_AT' | translate }}</label>
              <p class="date-value">{{ formatDateTime(transaction.updatedAt) }}</p>
            </div>
          </div>
        </div>

        <!-- Status -->
        <div class="info-section">
          <label>{{ 'FINANCE.TRANSACTIONS.DETAIL.STATUS' | translate }}</label>
          <div class="status-badge" [class.archived]="transaction.isArchived">
            {{ transaction.isArchived ? ('FINANCE.TRANSACTIONS.DETAIL.STATUS_ARCHIVED' | translate) :
            ('FINANCE.TRANSACTIONS.DETAIL.STATUS_ACTIVE' | translate) }}
          </div>
        </div>
      </div>
    </div>

    <!-- Linked Items Card -->
    <div class="detail-card linked-card"
      *ngIf="linkedNotes.length > 0 || linkedTasks.length > 0 || linkedTransactions.length > 0">
      <h3>
        <i class="bi bi-link-45deg"></i>
        {{ 'FINANCE.TRANSACTIONS.DETAIL.LINKED_ITEMS' | translate }}
      </h3>

      <div class="linked-sections">
        <!-- Linked Notes -->
        <div class="linked-section" *ngIf="linkedNotes.length > 0">
          <div class="section-header">
            <i class="bi bi-journal-text"></i>
            <span>{{ 'FINANCE.TRANSACTIONS.DETAIL.LINKED_NOTES' | translate }}</span>
            <span class="badge">{{ linkedNotes.length }}</span>
          </div>
          <div class="link-items">
            <a *ngFor="let note of linkedNotes" [routerLink]="['/notes', note.id]" class="link-item">
              <div class="link-icon note-icon">
                <i class="bi bi-journal-text"></i>
              </div>
              <div class="link-content">
                <div class="link-title">{{ note.title }}</div>
                <div class="link-snippet" *ngIf="note.snippet">{{ note.snippet }}</div>
              </div>
              <div class="link-arrow">
                <i class="bi bi-chevron-right"></i>
              </div>
            </a>
          </div>
        </div>

        <!-- Linked Tasks -->
        <div class="linked-section" *ngIf="linkedTasks.length > 0">
          <div class="section-header">
            <i class="bi bi-check-circle"></i>
            <span>{{ 'FINANCE.TRANSACTIONS.DETAIL.LINKED_TASKS' | translate }}</span>
            <span class="badge">{{ linkedTasks.length }}</span>
          </div>
          <div class="link-items">
            <a *ngFor="let task of linkedTasks" [routerLink]="['/tasks', task.id]" class="link-item">
              <div class="link-icon task-icon">
                <i class="bi bi-check-circle"></i>
              </div>
              <div class="link-content">
                <div class="link-title">{{ task.title }}</div>
                <div class="link-snippet" *ngIf="task.snippet">{{ task.snippet }}</div>
              </div>
              <div class="link-arrow">
                <i class="bi bi-chevron-right"></i>
              </div>
            </a>
          </div>
        </div>

        <!-- Linked Transactions -->
        <div class="linked-section" *ngIf="linkedTransactions.length > 0">
          <div class="section-header">
            <i class="bi bi-currency-dollar"></i>
            <span>{{ 'FINANCE.TRANSACTIONS.DETAIL.LINKED_TRANSACTIONS' | translate }}</span>
            <span class="badge">{{ linkedTransactions.length }}</span>
          </div>
          <div class="link-items">
            <a *ngFor="let tx of linkedTransactions" [routerLink]="['/finance/transactions', tx.id]" class="link-item">
              <div class="link-icon transaction-icon">
                <i class="bi bi-currency-dollar"></i>
              </div>
              <div class="link-content">
                <div class="link-title">{{ tx.title }}</div>
                <div class="link-snippet" *ngIf="tx.snippet">{{ tx.snippet }}</div>
              </div>
              <div class="link-arrow">
                <i class="bi bi-chevron-right"></i>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions Card -->
    <div class="detail-card actions-card">
      <h3>{{ 'FINANCE.TRANSACTIONS.DETAIL.ACTIONS' | translate }}</h3>
      <div class="action-buttons">
        <button class="btn btn-primary" (click)="editTransaction()">
          <span>‚úèÔ∏è</span> {{ 'FINANCE.TRANSACTIONS.DETAIL.EDIT' | translate }}
        </button>
        <button *ngIf="!transaction.isArchived" class="btn btn-secondary" (click)="archiveTransaction()">
          <span>üì¶</span> {{ 'FINANCE.TRANSACTIONS.DETAIL.ARCHIVE' | translate }}
        </button>
        <button *ngIf="transaction.isArchived" class="btn btn-secondary" (click)="restoreTransaction()">
          <span>‚Ü©Ô∏è</span> {{ 'FINANCE.TRANSACTIONS.DETAIL.RESTORE' | translate }}
        </button>
      </div>
    </div>
  </div>
</div>