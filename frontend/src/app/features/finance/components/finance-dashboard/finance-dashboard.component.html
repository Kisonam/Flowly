<div class="finance-dashboard">
  <h1 class="dashboard-title">{{ 'FINANCE.DASHBOARD.TITLE' | translate }}</h1>

  <div class="filters-section">
    <form [formGroup]="filterForm" class="filters-form">
      <div class="filter-group">
        <label>{{ 'FINANCE.DASHBOARD.FILTERS.PERIOD_FROM' | translate }}</label>
        <input type="date" formControlName="periodStart" class="filter-input" />
      </div>

      <div class="filter-group">
        <label>{{ 'FINANCE.DASHBOARD.FILTERS.PERIOD_TO' | translate }}</label>
        <input type="date" formControlName="periodEnd" class="filter-input" />
      </div>

      <div class="filter-group">
        <label>{{ 'FINANCE.DASHBOARD.FILTERS.CURRENCY' | translate }}</label>
        <select formControlName="currencyCode" class="filter-select">
          <option *ngFor="let currency of currencies" [value]="currency.code">
            {{ currency.symbol }} {{ currency.code }}
          </option>
        </select>
      </div>
    </form>
  </div>

  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>{{ 'FINANCE.DASHBOARD.LOADING' | translate }}</p>
  </div>

  <div *ngIf="errorMessage && !loading" class="error-state">
    <p>‚ùå {{ errorMessage }}</p>
  </div>

  <div *ngIf="!loading && !errorMessage && stats" class="dashboard-content">

    <div class="summary-cards">
      <div class="summary-card income">
        <div class="card-icon">üìà</div>
        <div class="card-content">
          <h3>{{ 'FINANCE.DASHBOARD.INCOME' | translate }}</h3>
          <p class="amount">{{ stats.totalIncome | number:'1.2-2' }} {{ stats.currencyCode }}</p>
          <span class="subtitle">{{ 'FINANCE.DASHBOARD.AVERAGE_DAY' | translate:{amount: ((stats.averageIncome || 0) |
            number:'1.2-2')} }}</span>
        </div>
      </div>

      <div class="summary-card expense">
        <div class="card-icon">üìâ</div>
        <div class="card-content">
          <h3>{{ 'FINANCE.DASHBOARD.EXPENSE' | translate }}</h3>
          <p class="amount">{{ stats.totalExpense | number:'1.2-2' }} {{ stats.currencyCode }}</p>
          <span class="subtitle">{{ 'FINANCE.DASHBOARD.AVERAGE_DAY' | translate:{amount: ((stats.averageExpense || 0) |
            number:'1.2-2')} }}</span>
        </div>
      </div>

      <div class="summary-card balance" [class.positive]="stats.balance >= 0" [class.negative]="stats.balance < 0">
        <div class="card-icon">üí∞</div>
        <div class="card-content">
          <h3>{{ 'FINANCE.DASHBOARD.BALANCE' | translate }}</h3>
          <p class="amount">{{ stats.balance | number:'1.2-2' }} {{ stats.currencyCode }}</p>
          <span class="subtitle">{{ 'FINANCE.DASHBOARD.TRANSACTIONS_COUNT' | translate:{count:
            (stats.totalTransactionCount || 0)} }}</span>
        </div>
      </div>
    </div>

    <div class="charts-section">
      
      <div class="chart-wrapper">
        <app-income-expense-chart [data]="incomeExpenseData" [chartType]="'bar'"
          [title]="'FINANCE.DASHBOARD.INCOME_VS_EXPENSE' | translate" [height]="'350px'"></app-income-expense-chart>
      </div>

      <div class="chart-wrapper">
        <app-category-breakdown-chart [data]="expenseCategoryData" [chartType]="'doughnut'"
          [title]="'FINANCE.DASHBOARD.EXPENSE_BY_CATEGORY' | translate" [height]="'350px'"
          [legendPosition]="'right'"></app-category-breakdown-chart>
      </div>

      <div class="chart-wrapper" *ngIf="incomeCategoryData.length > 0">
        <app-category-breakdown-chart [data]="incomeCategoryData" [chartType]="'doughnut'"
          [title]="'FINANCE.DASHBOARD.INCOME_BY_CATEGORY' | translate" [height]="'350px'"
          [legendPosition]="'right'"></app-category-breakdown-chart>
      </div>
    </div>

    <div class="budget-progress-section" *ngIf="budgetProgressData.length > 0">
      <app-budget-progress-chart [data]="budgetProgressData" [title]="'FINANCE.DASHBOARD.BUDGET_PROGRESS' | translate"
        [height]="'400px'" [showPercentage]="true"></app-budget-progress-chart>
    </div>

    <div class="category-breakdown">
      
      <div class="category-table-wrapper" *ngIf="stats.expenseByCategory && stats.expenseByCategory.length > 0">
        <h3>üìâ {{ 'FINANCE.DASHBOARD.EXPENSE_BY_CATEGORY' | translate }}</h3>
        <table class="category-table">
          <thead>
            <tr>
              <th>{{ 'FINANCE.DASHBOARD.TABLE.CATEGORY' | translate }}</th>
              <th class="align-right">{{ 'FINANCE.DASHBOARD.TABLE.AMOUNT' | translate }}</th>
              <th class="align-right">{{ 'FINANCE.DASHBOARD.TABLE.TRANSACTIONS' | translate }}</th>
              <th class="align-right">{{ 'FINANCE.DASHBOARD.TABLE.PERCENTAGE' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let category of stats.expenseByCategory">
              <td>{{ category.categoryName }}</td>
              <td class="align-right">{{ category.totalAmount | number:'1.2-2' }} {{ stats.currencyCode }}</td>
              <td class="align-right">{{ category.transactionCount }}</td>
              <td class="align-right">{{ category.percentage | number:'1.1-1' }}%</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="category-table-wrapper" *ngIf="stats.incomeByCategory && stats.incomeByCategory.length > 0">
        <h3>üìà {{ 'FINANCE.DASHBOARD.INCOME_BY_CATEGORY' | translate }}</h3>
        <table class="category-table">
          <thead>
            <tr>
              <th>{{ 'FINANCE.DASHBOARD.TABLE.CATEGORY' | translate }}</th>
              <th class="align-right">{{ 'FINANCE.DASHBOARD.TABLE.AMOUNT' | translate }}</th>
              <th class="align-right">{{ 'FINANCE.DASHBOARD.TABLE.TRANSACTIONS' | translate }}</th>
              <th class="align-right">{{ 'FINANCE.DASHBOARD.TABLE.PERCENTAGE' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let category of stats.incomeByCategory">
              <td>{{ category.categoryName }}</td>
              <td class="align-right">{{ category.totalAmount | number:'1.2-2' }} {{ stats.currencyCode }}</td>
              <td class="align-right">{{ category.transactionCount }}</td>
              <td class="align-right">{{ category.percentage | number:'1.1-1' }}%</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="recent-transactions">
      <h3>üïí {{ 'FINANCE.DASHBOARD.RECENT_TRANSACTIONS' | translate }}</h3>

      <div *ngIf="loadingTransactions" class="loading-transactions">
        <div class="spinner-small"></div>
        <p>{{ 'FINANCE.DASHBOARD.LOADING' | translate }}</p>
      </div>

      <div *ngIf="!loadingTransactions && recentTransactions.length === 0" class="empty-transactions">
        <p>üì≠ {{ 'FINANCE.DASHBOARD.NO_TRANSACTIONS' | translate }}</p>
      </div>

      <div *ngIf="!loadingTransactions && recentTransactions.length > 0" class="transactions-list">
        <div *ngFor="let transaction of recentTransactions" class="transaction-item"
          [class]="getTransactionTypeClass(transaction.type)">
          <div class="transaction-icon">{{ getTransactionTypeIcon(transaction.type) }}</div>
          <div class="transaction-details">
            <strong>{{ transaction.title }}</strong>
            <span class="transaction-category">{{ transaction.category?.name ||
              ('FINANCE.TRANSACTIONS.TABLE.UNCATEGORIZED' | translate) }}</span>
          </div>
          <div class="transaction-amount">
            <span class="amount">{{ transaction.type === 'Income' ? '+' : '-' }}{{ transaction.amount | number:'1.2-2'
              }} {{ transaction.currencyCode }}</span>
            <span class="date">{{ transaction.date | date:'dd/MM/yyyy' }}</span>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>