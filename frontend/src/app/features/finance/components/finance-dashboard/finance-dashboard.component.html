<div class="finance-dashboard">
  <h1 class="dashboard-title">üìä –§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –¥–∞—à–±–æ—Ä–¥</h1>

  <!-- Filters -->
  <div class="filters-section">
    <form [formGroup]="filterForm" class="filters-form">
      <div class="filter-group">
        <label>–ü–µ—Ä—ñ–æ–¥ –≤—ñ–¥</label>
        <input type="date" formControlName="periodStart" class="filter-input" />
      </div>

      <div class="filter-group">
        <label>–ü–µ—Ä—ñ–æ–¥ –¥–æ</label>
        <input type="date" formControlName="periodEnd" class="filter-input" />
      </div>

      <div class="filter-group">
        <label>–í–∞–ª—é—Ç–∞</label>
        <select formControlName="currencyCode" class="filter-select">
          <option *ngFor="let currency of currencies" [value]="currency.code">
            {{ currency.symbol }} {{ currency.code }}
          </option>
        </select>
      </div>
    </form>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage && !loading" class="error-state">
    <p>‚ùå {{ errorMessage }}</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading && !errorMessage && stats" class="dashboard-content">

    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card income">
        <div class="card-icon">üìà</div>
        <div class="card-content">
          <h3>–î–æ—Ö–æ–¥–∏</h3>
          <p class="amount">{{ stats.totalIncome | number:'1.2-2' }} {{ stats.currencyCode }}</p>
          <span class="subtitle">–°–µ—Ä–µ–¥–Ω—å–æ: {{ stats.averageIncome | number:'1.2-2' }}/–¥–µ–Ω—å</span>
        </div>
      </div>

      <div class="summary-card expense">
        <div class="card-icon">üìâ</div>
        <div class="card-content">
          <h3>–í–∏—Ç—Ä–∞—Ç–∏</h3>
          <p class="amount">{{ stats.totalExpense | number:'1.2-2' }} {{ stats.currencyCode }}</p>
          <span class="subtitle">–°–µ—Ä–µ–¥–Ω—å–æ: {{ stats.averageExpense | number:'1.2-2' }}/–¥–µ–Ω—å</span>
        </div>
      </div>

      <div class="summary-card balance" [class.positive]="stats.balance >= 0" [class.negative]="stats.balance < 0">
        <div class="card-icon">üí∞</div>
        <div class="card-content">
          <h3>–ë–∞–ª–∞–Ω—Å</h3>
          <p class="amount">{{ stats.balance | number:'1.2-2' }} {{ stats.currencyCode }}</p>
          <span class="subtitle">{{ stats.transactionCount }} —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π</span>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <!-- Income vs Expense Chart -->
      <div class="chart-container">
        <canvas #incomeExpenseChart></canvas>
      </div>

      <!-- Expense Breakdown Pie Chart -->
      <div class="chart-container pie-chart-container">
        <canvas #expensePieChart></canvas>

        <!-- Empty state for pie chart -->
        <div *ngIf="!stats.expenseByCategory || stats.expenseByCategory.length === 0" class="empty-chart">
          <p>üìä –ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö</p>
        </div>
      </div>
    </div>

    <!-- Category Breakdown Tables -->
    <div class="category-breakdown">
      <!-- Expense Categories -->
      <div class="category-table-wrapper" *ngIf="stats.expenseByCategory && stats.expenseByCategory.length > 0">
        <h3>üìâ –í–∏—Ç—Ä–∞—Ç–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö</h3>
        <table class="category-table">
          <thead>
            <tr>
              <th>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</th>
              <th class="align-right">–°—É–º–∞</th>
              <th class="align-right">–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó</th>
              <th class="align-right">%</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let category of stats.expenseByCategory">
              <td>{{ category.categoryName }}</td>
              <td class="align-right">{{ category.totalAmount | number:'1.2-2' }} {{ stats.currencyCode }}</td>
              <td class="align-right">{{ category.transactionCount }}</td>
              <td class="align-right">{{ category.percentage | number:'1.1-1' }}%</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Income Categories -->
      <div class="category-table-wrapper" *ngIf="stats.incomeByCategory && stats.incomeByCategory.length > 0">
        <h3>üìà –î–æ—Ö–æ–¥–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö</h3>
        <table class="category-table">
          <thead>
            <tr>
              <th>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</th>
              <th class="align-right">–°—É–º–∞</th>
              <th class="align-right">–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó</th>
              <th class="align-right">%</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let category of stats.incomeByCategory">
              <td>{{ category.categoryName }}</td>
              <td class="align-right">{{ category.totalAmount | number:'1.2-2' }} {{ stats.currencyCode }}</td>
              <td class="align-right">{{ category.transactionCount }}</td>
              <td class="align-right">{{ category.percentage | number:'1.1-1' }}%</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Recent Transactions -->
    <div class="recent-transactions">
      <h3>üïí –û—Å—Ç–∞–Ω–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó</h3>

      <div *ngIf="loadingTransactions" class="loading-transactions">
        <div class="spinner-small"></div>
        <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
      </div>

      <div *ngIf="!loadingTransactions && recentTransactions.length === 0" class="empty-transactions">
        <p>üì≠ –ù–µ–º–∞—î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π</p>
      </div>

      <div *ngIf="!loadingTransactions && recentTransactions.length > 0" class="transactions-list">
        <div *ngFor="let transaction of recentTransactions" class="transaction-item" [class]="getTransactionTypeClass(transaction.type)">
          <div class="transaction-icon">{{ getTransactionTypeIcon(transaction.type) }}</div>
          <div class="transaction-details">
            <strong>{{ transaction.title }}</strong>
            <span class="transaction-category">{{ transaction.category?.name || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó' }}</span>
          </div>
          <div class="transaction-amount">
            <span class="amount">{{ transaction.type === 'Income' ? '+' : '-' }}{{ transaction.amount | number:'1.2-2' }} {{ transaction.currencyCode }}</span>
            <span class="date">{{ transaction.date | date:'dd/MM/yyyy' }}</span>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
