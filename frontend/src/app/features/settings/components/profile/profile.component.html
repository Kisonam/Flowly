<div class="profile-section">
  
  <div class="section-card">
    <h2 class="section-title">{{ 'SETTINGS.PROFILE.AVATAR_TITLE' | translate }}</h2>

    <div class="avatar-container">
      <div class="avatar-preview">
        <div class="avatar-circle" [class.loading]="isUploadingAvatar">
          <img *ngIf="avatarPreview" [src]="avatarPreview" alt="Avatar" />
          <svg *ngIf="!avatarPreview" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </div>
      </div>

      <div class="avatar-actions">
        <input
          type="file"
          id="avatar-upload"
          accept="image/*"
          (change)="onFileSelected($event)"
          [disabled]="isUploadingAvatar"
          style="display: none"
        />
        <label for="avatar-upload" class="btn btn-primary" [class.disabled]="isUploadingAvatar">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="17 8 12 3 7 8"></polyline>
            <line x1="12" y1="3" x2="12" y2="15"></line>
          </svg>
          <span>{{ 'SETTINGS.PROFILE.UPLOAD_PHOTO' | translate }}</span>
        </label>

        <button
          *ngIf="avatarPreview"
          class="btn btn-danger"
          (click)="deleteAvatar()"
          [disabled]="isUploadingAvatar"
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
          <span>{{ 'SETTINGS.PROFILE.DELETE' | translate }}</span>
        </button>
      </div>

      <p class="avatar-hint">{{ 'SETTINGS.PROFILE.AVATAR_HINT' | translate }}</p>
    </div>
  </div>

  <div class="section-card">
    <h2 class="section-title">{{ 'SETTINGS.PROFILE.INFO_TITLE' | translate }}</h2>

    <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
      <div class="form-group">
        <label for="displayName">{{ 'SETTINGS.PROFILE.NAME_LABEL' | translate }}</label>
        <input
          type="text"
          id="displayName"
          formControlName="displayName"
          class="form-input"
          [placeholder]="'SETTINGS.PROFILE.NAME_PLACEHOLDER' | translate"
        />
        <span *ngIf="displayNameError" class="error-message">{{ displayNameError }}</span>
      </div>

      <div class="form-group">
        <label for="email">{{ 'SETTINGS.PROFILE.EMAIL_LABEL' | translate }}</label>
        <input
          type="email"
          id="email"
          formControlName="email"
          class="form-input"
          readonly
        />
        <span class="input-hint">{{ 'SETTINGS.PROFILE.EMAIL_READONLY' | translate }}</span>
      </div>

      <div class="form-actions">
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="profileForm.invalid || isLoadingProfile"
        >
          <span *ngIf="!isLoadingProfile">{{ 'SETTINGS.PROFILE.SAVE_CHANGES' | translate }}</span>
          <span *ngIf="isLoadingProfile">{{ 'SETTINGS.PROFILE.SAVING' | translate }}</span>
        </button>
      </div>

      <div *ngIf="profileMessage" class="success-message">{{ profileMessage }}</div>
      <div *ngIf="profileError" class="error-message">{{ profileError }}</div>
    </form>
  </div>

  <div class="section-card">
    <h2 class="section-title">{{ 'SETTINGS.PROFILE.PASSWORD_TITLE' | translate }}</h2>

    <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
      <div class="form-group">
        <label for="currentPassword">{{ 'SETTINGS.PROFILE.CURRENT_PASSWORD' | translate }}</label>
        <input
          type="password"
          id="currentPassword"
          formControlName="currentPassword"
          class="form-input"
          [placeholder]="'SETTINGS.PROFILE.CURRENT_PASSWORD_PLACEHOLDER' | translate"
        />
        <span *ngIf="currentPasswordError" class="error-message">{{ currentPasswordError }}</span>
      </div>

      <div class="form-group">
        <label for="newPassword">{{ 'SETTINGS.PROFILE.NEW_PASSWORD' | translate }}</label>
        <input
          type="password"
          id="newPassword"
          formControlName="newPassword"
          class="form-input"
          [placeholder]="'SETTINGS.PROFILE.NEW_PASSWORD_PLACEHOLDER' | translate"
        />
        <span *ngIf="newPasswordError" class="error-message">{{ newPasswordError }}</span>
      </div>

      <div class="form-group">
        <label for="confirmPassword">{{ 'SETTINGS.PROFILE.CONFIRM_PASSWORD' | translate }}</label>
        <input
          type="password"
          id="confirmPassword"
          formControlName="confirmPassword"
          class="form-input"
          [placeholder]="'SETTINGS.PROFILE.CONFIRM_PASSWORD_PLACEHOLDER' | translate"
        />
        <span *ngIf="confirmPasswordError" class="error-message">{{ confirmPasswordError }}</span>
      </div>

      <div class="form-actions">
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="passwordForm.invalid || isLoadingPassword"
        >
          <span *ngIf="!isLoadingPassword">{{ 'SETTINGS.PROFILE.CHANGE_PASSWORD' | translate }}</span>
          <span *ngIf="isLoadingPassword">{{ 'SETTINGS.PROFILE.CHANGING' | translate }}</span>
        </button>
      </div>

      <div *ngIf="passwordMessage" class="success-message">{{ passwordMessage }}</div>
      <div *ngIf="passwordError" class="error-message">{{ passwordError }}</div>
    </form>
  </div>
</div>
